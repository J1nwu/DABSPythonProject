{% extends "booking/admin_base.html" %}

{% block content %}
<h3 class="fw-bold mb-3">Manage Doctors</h3>

<form class="row g-2 mb-3" method="get">
  <div class="col-md-4">
    <input class="form-control"
           name="q"
           placeholder="Search doctor, email, hospital, city"
           value="{{ q }}">
  </div>

  <div class="col-md-3">
    <select class="form-select" name="status">
      <option value="">All Status</option>
      <option value="Pending"  {% if status == "Pending" %}selected{% endif %}>Pending</option>
      <option value="Active"   {% if status == "Active" %}selected{% endif %}>Active</option>
      <option value="Inactive" {% if status == "Inactive" %}selected{% endif %}>Inactive</option>
    </select>
  </div>

  <div class="col-md-3 d-flex gap-2">
    <button class="btn btn-primary flex-grow-1">Filter</button>
    <a class="btn btn-outline-secondary" href=".">Reset</a>
  </div>
</form>

<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Specialization</th>
        <th>Hospital</th>
        <th>City</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for d in doctors %}
      <tr>
        <td>{{ d.id }}</td>
        <td>Dr. {{ d.user.get_full_name }}</td>
        <td>{{ d.user.email }}</td>
        <td>{{ d.specialization }}</td>
        <td>{{ d.hospital }}</td>
        <td>{{ d.city }}</td>
        <td>
          <span class="badge bg-{% if d.status == 'Active' %}success{% elif d.status == 'Pending' %}warning text-dark{% else %}secondary{% endif %}">
            {{ d.status }}
          </span>
        </td>
        <td>
          <!-- All actions post back to the same view; it reads doctor_id + action -->
          <form method="post" action="" class="d-inline">
            {% csrf_token %}
            <input type="hidden" name="doctor_id" value="{{ d.id }}">
            <input type="hidden" name="action" value="activate">
            <button class="btn btn-sm btn-outline-success">Activate</button>
          </form>

          <form method="post" action="" class="d-inline ms-1">
            {% csrf_token %}
            <input type="hidden" name="doctor_id" value="{{ d.id }}">
            <input type="hidden" name="action" value="deactivate">
            <button class="btn btn-sm btn-outline-secondary">Deactivate</button>
          </form>

          <form method="post" action="" class="d-inline ms-1"
                onsubmit="return confirm('Delete this doctor and related appointments?');">
            {% csrf_token %}
            <input type="hidden" name="doctor_id" value="{{ d.id }}">
            <input type="hidden" name="action" value="delete">
            <button class="btn btn-sm btn-outline-danger">Delete</button>
          </form>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="8" class="text-muted">No doctors found.</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}