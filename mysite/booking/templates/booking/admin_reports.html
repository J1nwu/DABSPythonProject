{% extends "booking/admin_base.html" %}

{% block content %}

<h3 class="fw-bold mb-3">Reports</h3>

<!-- ========== FILTER BAR ========== -->
<form class="row g-2 mb-3" method="get">
  <div class="col-md-3">
    <select class="form-select" name="doctor">
      <option value="">All Doctors</option>
      {% for d in doctors %}
        <option value="{{ d.id }}"{% if doctor_filter and doctor_filter == d.id %} selected{% endif %}>
          Dr. {{ d.user.get_full_name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-2">
    <select class="form-select" name="status">
      <option value="">All Status</option>
      <option value="Pending"  {% if status_filter == "Pending" %}selected{% endif %}>Pending</option>
      <option value="Approved" {% if status_filter == "Approved" %}selected{% endif %}>Approved</option>
      <option value="Cancelled"{% if status_filter == "Cancelled" %}selected{% endif %}>Cancelled</option>
    </select>
  </div>

  <div class="col-md-2">
    <input type="date" class="form-control" name="start_date" value="{{ start_date }}">
  </div>

  <div class="col-md-2">
    <input type="date" class="form-control" name="end_date" value="{{ end_date }}">
  </div>

  <div class="col-md-3 d-flex gap-2">
    <button class="btn btn-primary flex-grow-1">Filter</button>
    <a class="btn btn-outline-secondary" href=".">Reset</a>
  </div>
</form>

<!-- ========== SUMMARY CARDS ========== -->
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-uppercase text-muted small">Total Appointments</div>
        <div class="fs-3 fw-bold">{{ total_appointments }}</div>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-uppercase text-muted small">Pending</div>
        <div class="fs-3 fw-bold">{{ pending_count }}</div>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-uppercase text-muted small">Approved</div>
        <div class="fs-3 fw-bold">{{ approved_count }}</div>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-uppercase text-muted small">Cancelled</div>
        <div class="fs-3 fw-bold">{{ cancelled_count }}</div>
      </div>
    </div>
  </div>
</div>

<!-- ========== STATUS BREAKDOWN ========== -->
<div class="card shadow-sm border-0 mb-3">
  <div class="card-body">
    <h5 class="fw-bold mb-3">Status Breakdown</h5>

    <div class="table-responsive">
      <table class="table mb-0">
        <thead class="table-light">
          <tr>
            <th>Status</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
        {% for row in status_counts %}
          <tr>
            <td>{{ row.status }}</td>
            <td>{{ row.total }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="2" class="text-muted">No data.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ========== DAILY OVERVIEW ========== -->
<div class="card shadow-sm border-0 mb-3">
  <div class="card-body">
    <h5 class="fw-bold mb-3">Daily Overview (last 30 days in result)</h5>

    <div class="table-responsive">
      <table class="table mb-0">
        <thead class="table-light">
          <tr>
            <th>Date</th>
            <th>Total</th>
            <th>Pending</th>
            <th>Approved</th>
            <th>Cancelled</th>
          </tr>
        </thead>
        <tbody>
        {% for d in daily_counts %}
          <tr>
          <td>{{ d.date }}</td>
            <td>{{ d.total }}</td>
            <td>{{ d.pending }}</td>
            <td>{{ d.approved }}</td>
            <td>{{ d.cancelled }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="5" class="text-muted">No daily data.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}